# @title
from __future__ import annotations
import numpy as np
from typing import Tuple

datasets = {}

def parse_tsp_file(filepath: str):
    with open(filepath, "r") as file:
        lines = file.readlines()

    tsp_data = {
        # "name": None,
        "dimension": None,
        "edge_weight_type": None,
        "node_coords": []
    }

    parsing_nodes = False  # 标记是否开始解析坐标

    for line in lines:
        line = line.strip()
        # if line.startswith("NAME"):
        #     tsp_data["name"] = line.split(":")[1].strip()
        if line.startswith("DIMENSION"):
            tsp_data["dimension"] = int(line.split(":")[1].strip())
        elif line.startswith("EDGE_WEIGHT_TYPE"):
            tsp_data["edge_weight_type"] = line.split(":")[1].strip()
        elif line.startswith("NODE_COORD_SECTION"):
            parsing_nodes = True
        elif line == "EOF":
            break
        elif parsing_nodes:
            parts = line.split()
            if len(parts) == 3:
                _, x, y = parts
                tsp_data["node_coords"].append((int(x), int(y)))

    return tsp_data  # 返回一个列表，符合 main() 的 inputs 格式

# 解析 TSP 数据
# tsp_instances = parse_tsp_file("./data/att48/att48.tsp")
datasets['att48'] = parse_tsp_file("./data/tsp/att48.tsp")

# datasets['train'] = {'eil51': {'dimension': 51, 'edge_weight_type': 'EUC_2D', 
#                                 'node_coords': [(37, 52), (49, 49), (52, 64), (20, 26), (40, 30), (21, 47), (17, 63), (31, 62),
#                                                 (52, 33), (51, 21), (42, 41), (31, 32), (5, 25), (12, 42), (36, 16), (52, 41), 
#                                                 (27, 23), (17, 33), (13, 13), (57, 58), (62, 42), (42, 57), (16, 57), (8, 52), 
#                                                 (7, 38), (27, 68), (30, 48), (43, 67), (58, 48), (58, 27), (37, 69), (38, 46), 
#                                                 (46, 10), (61, 33), (62, 63), (63, 69), (32, 22), (45, 35), (59, 15), (5, 6), 
#                                                 (10, 17), (21, 10), (5, 64), (30, 15), (39, 10), (32, 39), (25, 32), (25, 55), 
#                                                 (48, 28), (56, 37), (30, 40)]},
#                     'eil101': {'dimension': 101, 'edge_weight_type': 'EUC_2D', 
#                                 'node_coords': [(41, 49), (35, 17), (55, 45), (55, 20), (15, 30), (25, 30), (20, 50), (10, 43), 
#                                                 (55, 60), (30, 60), (20, 65), (50, 35), (30, 25), (15, 10), (30, 5), (10, 20), 
#                                                 (5, 30), (20, 40), (15, 60), (45, 65), (45, 20), (45, 10), (55, 5), (65, 35), 
#                                                 (65, 20), (45, 30), (35, 40), (41, 37), (64, 42), (40, 60), (31, 52), (35, 69), 
#                                                 (53, 52), (65, 55), (63, 65), (2, 60), (20, 20), (5, 5), (60, 12), (40, 25), (42, 7), 
#                                                 (24, 12), (23, 3), (11, 14), (6, 38), (2, 48), (8, 56), (13, 52), (6, 68), (47, 47), 
#                                                 (49, 58), (27, 43), (37, 31), (57, 29), (63, 23), (53, 12), (32, 12), (36, 26), 
#                                                 (21, 24), (17, 34), (12, 24), (24, 58), (27, 69), (15, 77), (62, 77), (49, 73), 
#                                                 (67, 5), (56, 39), (37, 47), (37, 56), (57, 68), (47, 16), (44, 17), (46, 13), 
#                                                 (49, 11), (49, 42), (53, 43), (61, 52), (57, 48), (56, 37), (55, 54), (15, 47), 
#                                                 (14, 37), (11, 31), (16, 22), (4, 18), (28, 18), (26, 52), (26, 35), (31, 67), 
#                                                 (15, 19), (22, 22), (18, 24), (26, 27), (25, 24), (22, 27), (25, 21), (19, 21), 
#                                                 (20, 26), (18, 18), (35, 35)]}
#                     }

# datasets['test'] = {'eil76': {'dimension': 76, 'edge_weight_type': 'EUC_2D', 
#                                'node_coords': [(22, 22), (36, 26), (21, 45), (45, 35), (55, 20), (33, 34), (50, 50), (55, 45), (26, 59),
#                                             (40, 66), (55, 65), (35, 51), (62, 35), (62, 57), (62, 24), (21, 36), (33, 44), (9, 56), 
#                                             (62, 48), (66, 14), (44, 13), (26, 13), (11, 28), (7, 43), (17, 64), (41, 46), (55, 34), 
#                                             (35, 16), (52, 26), (43, 26), (31, 76), (22, 53), (26, 29), (50, 40), (55, 50), (54, 10), 
#                                             (60, 15), (47, 66), (30, 60), (30, 50), (12, 17), (15, 14), (16, 19), (21, 48), (50, 30), 
#                                             (51, 42), (50, 15), (48, 21), (12, 38), (15, 56), (29, 39), (54, 38), (55, 57), (67, 41), 
#                                             (10, 70), (6, 25), (65, 27), (40, 60), (70, 64), (64, 4), (36, 6), (30, 20), (20, 30), 
#                                             (15, 5), (50, 70), (57, 72), (45, 42), (38, 33), (50, 4), (66, 8), (59, 5), (35, 60), 
#                                             (27, 24), (40, 20), (40, 37), (40, 40)]}
#                     } 

print(datasets)